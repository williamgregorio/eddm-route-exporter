(()=>{"use strict";const e="table.target-audience-table";let t=!1;t||(t=!0,chrome.runtime.onMessage.addListener(((t,o,n)=>{if("PING"===t.action)return n({status:"PING"}),!0;if("EXPORT_TYPE"===t.action){const o=t.exportType,n=function(t){const o=function(t){const o=document.querySelectorAll(`${e} tbody`);if(!o||0===o.length)return console.error("getRowsToExport: Could not find table body."),alert("Alert: Could not find a valid table."),null;const n=o[0].querySelectorAll("tr.list-items");if("selected"===t){const e=Array.from(n).filter((e=>{console.log(e);const t=e.querySelector("td:first-child input.routeChex");return t&&t.checked}));return 0===e.length?(console.warn("Export: No rows selected."),alert("No routes are currently selected. Please check the boxes next to the routes you want to export."),null):(console.log("getRowsToExport (selected): Selected rows found:",e),e)}return 0===n.length?(console.warn("Export: No rows found in the table"),alert("No route data rows found in the table."),null):(console.log(n),n)}(t);if(!o)return null;const n=function(t){const o=[],n=document.querySelector(e);if(!n)return console.error("extractDataFromRows: Could not find table."),[];const r=n.querySelectorAll("thead th");if(r.length>1){const e=Array.from(r).slice(1).map((e=>e.textContent.replace(/\s+/g," ").trim()));o.push(e)}else console.warn("Export: Could not find enough header cells.");return Array.from(t).forEach((e=>{const t=e.querySelectorAll("td");if(console.log("Cells:",t),!(t.length>2))return console.log("Export dev: Found a row with unexpected cell count.",e),null;{const e=o[0]?.length||t.length-2,n=Array.from(t).slice(1,1+e).map((e=>e.textContent.trim()));o.push(n)}})),console.log(o),o}(o);return n.length<=1?(console.warn("Export: No data extracted or only headers found."),null):(r=n,console.log(r),r.map((e=>e.map((e=>{const t=e.replace(/"/g,'""');return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t}"`:t})).join(","))).join("\n"));var r}(o);return chrome.runtime.sendMessage({action:"EXPORT_RESULT",status:n?"success":"failure",data:n,exportType:o}),!1}})))})();