(()=>{"use strict";const e="table.target-audience-table";chrome.runtime.onMessage.addListener(((t,o,n)=>{if(console.log("Content script (bundled): Message received",t),"EXPORT_COMMAND"===t.action){const o=t.exportType;console.log(`Content script (bundled): Received EXPORT_COMMAND for type: ${o}`);const n=function(t){console.log(`USPS EDDM Export: Starting to export for ${t}.`);const o=function(t){const o=document.querySelectorAll(`${e} tbody`);if(console.log(o),!o||0===o.length)return console.error("getRowsToExport: Could not find table body."),alert("Alert: Could not find a valid table."),null;const n=o[0];console.log(n);const r=n.querySelectorAll("tr.list-items");if("selected"===t){const e=Array.from(r).filter((e=>{const t=e.querySelector("td:first-child input.routeChex");return t&&t.checked}));return 0===e.length?(console.warn("Export: No rows selected."),alert("No routes are currently selected. Please check the boxes next to the routes you want to export."),null):e}return 0===r.length?(console.warn("Export: No rows found in the table"),alert("No route data rows found in the table."),null):r}(t);if(!o)return null;const n=function(t){const o=[],n=document.querySelector(e);if(!n)return console.error("extractDataFromRows: Could not find table."),[];const r=n.querySelectorAll("thead th");if(r.length>1){const e=Array.from(r).slice(1).map((e=>e.textContent.replace(/\s+/g," ").trim()));o.push(e)}else console.warn("Export: Could not find enough header cells.");return Array.from(t).forEach((e=>{const t=e.querySelectorAll("td");if(t.length>2){const e=o[0]?.length||t.length-2,n=Array.from(t).slice(1,1+e).map((e=>e.textContent.trim()));o.push(n)}else console.warn("Export: Found a row with unexpected cell count.",e)})),console.log(o),o}(o);if(n.length<=1)return console.warn("Export: No data extracted or only headers found."),null;const r=(l=n,console.log(l),l.map((e=>e.map((e=>{const t=e.replace(/"/g,'""');return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t}"`:t})).join(","))).join("\n"));var l;return(new Date).toISOString().slice(0,10),console.log("USPS EDDM Export: CSV generated."),r}(o);chrome.runtime.sendMessage({action:"EXPORT_RESULT",status:n?"success":"failure",data:n,exportType:o})}return!1})),console.log("Content script (bundled): Loaded and listener has been added.")})();